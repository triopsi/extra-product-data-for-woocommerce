class t{constructor(){this.modal=document.getElementById("exprdawc-import-export-modal"),this.modal?(this.exportSection=document.getElementById("exprdawc-export-section"),this.importSection=document.getElementById("exprdawc-import-section"),this.modalTitle=document.getElementById("exprdawc-modal-title"),this.exportTextarea=document.getElementById("exprdawc-export-textarea"),this.importTextarea=document.getElementById("exprdawc-import-textarea"),this.copyExportBtn=document.getElementById("exprdawc-copy-export"),this.importBtn=document.getElementById("exprdawc-import-button"),this.modalCloseBtn=document.getElementById("exprdawc-modal-close-btn"),this.modalCloseIcon=document.querySelector(".exprdawc-modal-close"),this.importNotice=document.querySelector(".exprdawc-import-notice"),this.importNoticeMessage=document.querySelector(".exprdawc-import-notice-message"),this.init()):console.warn("ExprdawcImportExportModal: Modal element not found")}init(){const t=document.querySelector("a.exprdawc-export"),e=document.querySelector("a.exprdawc-import");t&&t.addEventListener("click",t=>{t.preventDefault(),console.log("Export button clicked"),this.openExportModal()}),e&&e.addEventListener("click",t=>{t.preventDefault(),console.log("Import button clicked"),this.openImportModal()}),this.copyExportBtn&&this.copyExportBtn.addEventListener("click",()=>this.copyToClipboard()),this.importBtn&&this.importBtn.addEventListener("click",()=>this.handleImport()),this.modalCloseBtn&&this.modalCloseBtn.addEventListener("click",()=>this.closeModal()),this.modalCloseIcon&&this.modalCloseIcon.addEventListener("click",()=>this.closeModal());const o=this.modal.querySelector(".exprdawc-modal-overlay");o&&o.addEventListener("click",()=>this.closeModal()),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.modal.classList.contains("active")&&this.closeModal()})}openExportModal(){this.modalTitle.textContent=exprdawc_admin_meta_boxes.exportTitle||"Export Custom Fields";const t=document.getElementById("exprdawc_export_string");t&&t.value?(this.exportTextarea.value=t.value,this.exportSection.style.display="block",this.importSection.style.display="none",this.importTextarea.value="",this.hideNotice(),this.openModal()):this.showNotice(exprdawc_admin_meta_boxes.emptyExportMsg||"No custom fields to export.","error")}openImportModal(){this.modalTitle.textContent=exprdawc_admin_meta_boxes.importTitle||"Import Custom Fields",this.exportSection.style.display="none",this.importSection.style.display="block",this.importTextarea.value="",this.hideNotice(),this.openModal()}openModal(){this.modal.classList.add("active"),document.body.style.overflow="hidden"}closeModal(){this.modal.classList.remove("active"),document.body.style.overflow=""}async copyToClipboard(){const t=this.exportTextarea.value;if(t)try{await navigator.clipboard.writeText(t);const e=this.copyExportBtn.innerHTML;this.copyExportBtn.innerHTML='<span class="dashicons dashicons-yes-alt"></span>'+(exprdawc_admin_meta_boxes.copySuccessMsg||"Copied!"),this.copyExportBtn.disabled=!0,setTimeout(()=>{this.copyExportBtn.innerHTML=e,this.copyExportBtn.disabled=!1},2e3)}catch(e){console.error("Could not copy text: ",e),this.showNotice(exprdawc_admin_meta_boxes.copyErrorMsg||"Failed to copy to clipboard.","error")}else this.showNotice(exprdawc_admin_meta_boxes.emptyExportMsg||"Nothing to copy.","error")}handleImport(){const t=this.importTextarea.value.trim();if(!t)return void this.showNotice(exprdawc_admin_meta_boxes.enterExportString||"Please paste the JSON code.","error");try{JSON.parse(t)}catch(o){return void this.showNotice(exprdawc_admin_meta_boxes.invalidJsonMsg||"Invalid JSON format. Please check your input.","error")}const e=exprdawc_admin_meta_boxes.sureImportQuestion||"Are you sure you want to import these fields? This will replace all existing fields.";confirm(e)&&this.sendImportRequest(t)}sendImportRequest(t){const e=document.getElementById("post_ID").value;this.importBtn.disabled=!0;const o=this.importBtn.innerHTML;this.importBtn.innerHTML='<span class="dashicons dashicons-admin-generic" style="animation: spin 1s linear infinite;"></span>'+(exprdawc_admin_meta_boxes.importingMsg||"Importing..."),jQuery.ajax({url:ajaxurl,method:"POST",data:{action:"exprdawc_import_custom_fields",product_id:e,export_string:t,security:exprdawc_admin_meta_boxes.edit_exprdawc_nonce},success:t=>{this.importBtn.disabled=!1,this.importBtn.innerHTML=o,t.success?(this.showNotice(exprdawc_admin_meta_boxes.importSuccessMsg||"Fields imported successfully!","success"),setTimeout(()=>{window.location.reload()},1500)):this.showNotice(t.data||exprdawc_admin_meta_boxes.importErrorMsg||"An error occurred during import.","error")},error:()=>{this.importBtn.disabled=!1,this.importBtn.innerHTML=o,this.showNotice(exprdawc_admin_meta_boxes.importErrorMsg||"Failed to communicate with server.","error")}})}showNotice(t,e="info"){this.importNotice&&(this.importNoticeMessage.textContent=t,this.importNotice.className="exprdawc-import-notice "+e,this.importNotice.style.display="block")}hideNotice(){this.importNotice&&(this.importNotice.style.display="none",this.importNotice.className="exprdawc-import-notice")}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new t}):new t;
