jQuery(function(e){new class{constructor(){this.$orderItemsContainer=e("#woocommerce-order-items"),this.modalView=null,this.initialize()}initialize(){this.setupEventHandlers()}setupEventHandlers(){this.$orderItemsContainer.on("click","button.exprdawc_edit_addons",{action:"edit"},this.handleEditButtonClick.bind(this))}handleEditButtonClick(t){t.preventDefault();const o=e.WCBackboneModal.View.extend({addButton:this.handleDoneButtonClick.bind(this)}),i=e(t.currentTarget).closest("tr.item").attr("data-order_item_id");return this.modalView=new o({target:"wc-modal-edit-exprdawc",string:{action:wc_exprdawc_admin_order_params.i18n_edit,item_id:i}}),this.populateModalForm(),!1}populateModalForm(){this.blockUI(this.modalView.$el.find(".wc-backbone-modal-content"));const t={action:"woocommerce_configure_exprdawc_order_item",item_id:this.modalView._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_exprdawc_admin_order_params.edit_exprdawc_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,t,e=>{e.data&&e.success?(this.modalView.$el.find("form").html(e.data.html),this.unblockUI(this.modalView.$el.find(".wc-backbone-modal-content"))):(window.alert(wc_exprdawc_admin_order_params.i18n_form_error),this.unblockUI(this.modalView.$el.find(".wc-backbone-modal-content")),this.modalView.$el.find(".modal-close").trigger("click"))})}handleDoneButtonClick(t){const o=e.extend({},{action:"woocommerce_edit_exprdawc_order_item",item_id:this.modalView._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_exprdawc_admin_order_params.edit_exprdawc_nonce}),i=this.modalView.$el.find("form")[0];if(!0!==i.reportValidity())return;const n=new FormData(i);for(const e in o)n.append(e,o[e]);this.blockUI(this.modalView.$el.find(".wc-backbone-modal-content")),e.post({url:woocommerce_admin_meta_boxes.ajax_url,type:"POST",data:n,processData:!1,contentType:!1,cache:!1,success:o=>{o.data&&o.success?(this.$orderItemsContainer.find(".inside").empty(),this.$orderItemsContainer.find(".inside").append(o.data.html),this.$orderItemsContainer.trigger("wc_order_items_reloaded"),o.data.notes_html&&(e("ul.order_notes").empty(),e("ul.order_notes").append(e(o.data.notes_html).find("li"))),this.unblockUI(this.modalView.$el.find(".wc-backbone-modal-content")),this.blockUI(this.$orderItemsContainer,{fadeIn:0}),setTimeout(()=>{this.unblockUI(this.$orderItemsContainer)},250),this.modalView.closeButton(t)):(window.alert(o.data.message),this.unblockUI(this.modalView.$el.find(".wc-backbone-modal-content")))},error:()=>{window.alert(wc_exprdawc_admin_order_params.i18n_validation_error),this.unblockUI(this.modalView.$el.find(".wc-backbone-modal-content"))}})}blockUI(t,o){const i=e.extend({},{message:null,overlayCSS:{background:"#fff",opacity:.6}},o||{});t.block(i)}unblockUI(e){e.unblock()}}});
